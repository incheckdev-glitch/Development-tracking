<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ======================= META / TITLE ======================= -->
  <meta charset="UTF-8" />
  <title>üìä Attendance & Leave Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ======================= CSS LIBS ======================= -->
  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- DataTables core & buttons -->
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"
  />
  <link
    rel="stylesheet"
    href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css"
  />
  <!-- Select2 -->
  <link
    href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
    rel="stylesheet"
  />

  <!-- ======================= JS LIBS ======================= -->
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- PapaParse CSV (not used now, but left for fallback) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <!-- jQuery (required by DataTables & Select2) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- DataTables + Buttons -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <!-- pdfmake for DataTables export + PDF snapshot -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
  <!-- Select2 -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <!-- html2canvas for PDF snapshot -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- ======================= PAGE STYLES ======================= -->
  <style>
    /* Dark mode quick toggle */
    body.dark-mode {
      background: #181a1f;
      color: #eee;
    }

    /* Card hover micro-interaction */
    .card {
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    /* Sticky filter bar */
    .filter-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: inherit;
      padding: 10px;
    }

    /* Row highlights */
    .holiday-row {
      background-color: #ffeeba !important; /* light yellow */
    }
    .weekend-row {
      background-color: #f0f0f0 !important; /* light grey */
    }
    .leave-row {
      background-color: #cce5ff !important; /* light blue */
    }

    /* KPI Cards */
    .kpi-card h5 {
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    .kpi-card h3 {
      margin: 0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- ======================= MAIN WRAPPER ======================= -->
  <div class="container-fluid p-4" id="reportArea">
    <!-- ======= HEADER ======= -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>üìä Attendance & Leave Dashboard</h2>
      <div>
        <button class="btn btn-outline-secondary me-2" onclick="toggleDark()">üåô/‚òÄÔ∏è</button>
        <button class="btn btn-success" onclick="downloadFullReport()">Download Report</button>
      </div>
    </div>

    <!-- ======= FILTERS ======= -->
    <div class="card shadow filter-bar mb-4">
      <div class="card-body row g-3 align-items-end">
        <!-- Employee multi-select -->
        <div class="col-lg-3">
          <label class="form-label">Employee</label>
          <select id="employeeFilter" multiple></select>
        </div>

        <!-- Date from -->
        <div class="col-lg-3">
          <label class="form-label">Start Date</label>
          <input type="date" id="startDate" class="form-control" />
        </div>

        <!-- Date to -->
        <div class="col-lg-3">
          <label class="form-label">End Date</label>
          <input type="date" id="endDate" class="form-control" />
        </div>

        <!-- Quick search -->
        <div class="col-lg-3">
          <label class="form-label">Quick Search</label>
          <input type="text" id="quickSearch" class="form-control" placeholder="Search..." />
        </div>

        <div class="col-12 text-end mt-3">
          <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
          <button class="btn btn-warning" onclick="resetFilters()">Reset</button>
        </div>
      </div>
    </div>

    <!-- ======= KPI CARDS ======= -->
    <div class="row mb-4 text-center">
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Total Hours</h5>
            <h3 id="totalHours">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Avg Hours</h5>
            <h3 id="avgHours">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Workdays</h5>
            <h3 id="daysCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Late</h5>
            <h3 id="lateCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Early Leaves</h5>
            <h3 id="earlyCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Absent</h5>
            <h3 id="absentCount">0</h3>
          </div>
        </div>
      </div>
    </div>

    <div class="row mb-4 text-center">
      <div class="col-md-3">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Annual Leaves</h5>
            <h3 id="annualLeaveCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Sick Leaves</h5>
            <h3 id="sickLeaveCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Unpaid Leaves</h5>
            <h3 id="unpaidLeaveCount">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow kpi-card">
          <div class="card-body">
            <h5>Holidays</h5>
            <h3 id="holidayCount">0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- ======= ATTENDANCE TABLE ======= -->
    <div class="card shadow mb-4">
      <div class="card-body">
        <table id="attendanceTable" class="display nowrap table table-striped" style="width: 100%"></table>
      </div>
    </div>

    <!-- ======= CHARTS ======= -->
    <div class="row">
      <div class="col-lg-4">
        <div class="card shadow p-3">
          <h5>Hours per Day</h5>
          <canvas id="barChart"></canvas>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card shadow p-3">
          <h5>Hours by Employee</h5>
          <canvas id="pieChart"></canvas>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="card shadow p-3">
          <h5>Trend</h5>
          <canvas id="lineChart"></canvas>
        </div>
      </div>
    </div>

    <!-- ======= SETTINGS ======= -->
    <div class="card shadow my-4">
      <div class="card-body row g-3">
        <h5>‚öôÔ∏è Settings</h5>
        <div class="col-md-3">
          <label class="form-label">Late After (HH:MM)</label>
          <input type="time" id="lateThreshold" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Early Leave Before (HH:MM)</label>
          <input type="time" id="earlyThreshold" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Half-day Max Hours</label>
          <input type="number" id="halfDayHours" class="form-control" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Overtime Min Hours</label>
          <input type="number" id="overtimeHours" class="form-control" />
        </div>
      </div>
    </div>

    <!-- ======= HOLIDAY MANAGER ======= -->
    <div class="card shadow mb-4">
      <div class="card-body">
        <h5>üìÖ Holiday Manager</h5>
        <div class="input-group mb-3">
          <input type="date" id="holidayDate" class="form-control" />
          <input type="text" id="holidayName" class="form-control" placeholder="Holiday Name (optional)" />
          <button class="btn btn-primary" onclick="addHoliday()">Add</button>
        </div>
        <ul id="holidayList" class="list-group"></ul>
      </div>
    </div>

    <!-- ======= LEAVE MANAGER ======= -->
    <div class="card shadow mb-4">
      <div class="card-body">
        <h5>üìù Leave Manager</h5>
        <div class="row g-2">
          <div class="col-md-3">
            <input type="date" id="leaveDate" class="form-control" />
          </div>
          <div class="col-md-3">
            <input type="text" id="leaveEmployee" class="form-control" placeholder="Employee Name" />
          </div>
          <div class="col-md-3">
            <select id="leaveType" class="form-select">
              <option value="Annual">Annual Leave</option>
              <option value="Sick">Sick Leave</option>
              <option value="Unpaid">Unpaid Leave</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary" onclick="addLeave()">Add Leave</button>
          </div>
        </div>
        <ul id="leaveList" class="list-group mt-3"></ul>
      </div>
    </div>

    <!-- ======= BALANCE MANAGER ======= -->
    <div class="card shadow mb-4">
      <div class="card-body">
        <h5>üìä Leave Balances</h5>
        <table id="balanceTable" class="table table-bordered table-sm">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Annual Balance</th>
              <th>Sick Balance</th>
              <th>Unpaid Balance</th>
              <th>Save</th>
            </tr>
          </thead>
          <tbody id="balanceBody"></tbody>
        </table>
      </div>
    </div>
  </div>
<script>
/* ----------------------------------------------------------
 * CONFIG
 * ---------------------------------------------------------- */
const API_URL =
  "https://script.google.com/macros/s/AKfycby4i9AoZgoPGKQ4eEwCzm40DPP5YtIFKXoPgVipCuR2t90e5aZpYb2WLJ5Pk3X4fARQ/exec";
const SECRET = "a9fj32klsdfj0932LKJSDF90wef9";

// Canonical data
let CANON = [];
let HOLIDAYS = [];
let LEAVES = [];
let BALANCES = [];

// DataTable + charts handles
let DT = null;
let barChartHandle = null;
let pieChartHandle = null;
let lineChartHandle = null;

/* ----------------------------------------------------------
 * UTILITIES
 * ---------------------------------------------------------- */
function toggleDark() {
  document.body.classList.toggle("dark-mode");
}
function normalizeDate(d) {
  if (!d) return "";
  const s = String(d).trim();
  if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;
  const dt = new Date(s);
  if (!isNaN(dt)) return dt.toISOString().slice(0, 10);
  return "";
}
function parsePunchWithDate(dateISO, value) {
  if (!value) return null;
  const dt = new Date(value);
  return isNaN(dt) ? null : dt;
}

/* ----------------------------------------------------------
 * STATUS RULES
 * ---------------------------------------------------------- */
function computeStatus(row) {
  const s = JSON.parse(localStorage.getItem("settings") || "{}");
  const late = (s.late || "08:15").split(":").map(Number);
  const early = (s.early || "16:30").split(":").map(Number);
  const half = parseFloat(s.half ?? 4);
  const over = parseFloat(s.over ?? 9);

  // check if holiday
  const holiday = HOLIDAYS.find(h => h.date === row.date);
  if (holiday) return ["Holiday: " + (holiday.name || "")];

  // check if leave
  const lv = LEAVES.find(l => l.date === row.date && l.employee === row.employee);
  if (lv) return [lv.type + " Leave"];

  // check absent / weekend
  if (!row.signInDT && !row.signOutDT) {
    const dow = new Date(`${row.date}T00:00:00`).getDay();
    if (dow === 0 || dow === 6) return ["Weekend"];
    return ["Absent"];
  }

  if ((row.signInDT && !row.signOutDT) || (!row.signInDT && row.signOutDT))
    return ["Needs Correction"];

  const inMin = row.signInDT ? row.signInDT.getHours() * 60 + row.signInDT.getMinutes() : null;
  const outMin = row.signOutDT ? row.signOutDT.getHours() * 60 + row.signOutDT.getMinutes() : null;

  const status = [];
  if (inMin !== null && inMin > (late[0] * 60 + late[1])) status.push("Late");
  if (outMin !== null && outMin < (early[0] * 60 + early[1])) status.push("Early Leave");
  if (row.totalHours > 0 && row.totalHours < half) status.push("Half-day");
  if (row.totalHours >= over) status.push("Overtime");
  if (!status.length) status.push("On Time");
  return status;
}

/* ----------------------------------------------------------
 * HOLIDAY MANAGER
 * ---------------------------------------------------------- */
function renderHolidayList() {
  const list = document.getElementById("holidayList");
  list.innerHTML = "";
  HOLIDAYS.forEach((h, i) => {
    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `<span>${h.date}${h.name ? " - " + h.name : ""}</span>
      <button class="btn btn-sm btn-danger" onclick="removeHoliday(${i})">Remove</button>`;
    list.appendChild(li);
  });
  document.getElementById("holidayCount").textContent = HOLIDAYS.length;
}
async function addHoliday() {
  const date = document.getElementById("holidayDate").value;
  const name = document.getElementById("holidayName").value;
  if (!date) return alert("Choose a date");
  const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=Holidays&action=add`, {
    method: "POST",
    body: JSON.stringify([date, name]),
    headers: { "Content-Type": "application/json" }
  });
  const j = await res.json();
  if (j.ok) loadData();
}
async function removeHoliday(idx) {
  const h = HOLIDAYS[idx];
  const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=Holidays&action=remove`, {
    method: "POST",
    body: JSON.stringify(h),
    headers: { "Content-Type": "application/json" }
  });
  const j = await res.json();
  if (j.ok) loadData();
}

/* ----------------------------------------------------------
 * LEAVE MANAGER
 * ---------------------------------------------------------- */
function renderLeaveList() {
  const list = document.getElementById("leaveList");
  list.innerHTML = "";
  LEAVES.forEach((l, i) => {
    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `<span>${l.date} - ${l.employee} (${l.type})</span>
      <button class="btn btn-sm btn-danger" onclick="removeLeave(${i})">Remove</button>`;
    list.appendChild(li);
  });
}
async function addLeave() {
  const date = document.getElementById("leaveDate").value;
  const emp = document.getElementById("leaveEmployee").value;
  const type = document.getElementById("leaveType").value;
  if (!date || !emp || !type) return alert("Fill all fields");
  const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=Leaves&action=add`, {
    method: "POST",
    body: JSON.stringify([date, emp, type]),
    headers: { "Content-Type": "application/json" }
  });
  const j = await res.json();
  if (j.ok) loadData();
}
async function removeLeave(idx) {
  const l = LEAVES[idx];
  const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=Leaves&action=remove`, {
    method: "POST",
    body: JSON.stringify(l),
    headers: { "Content-Type": "application/json" }
  });
  const j = await res.json();
  if (j.ok) loadData();
}

/* ----------------------------------------------------------
 * BALANCE MANAGER
 * ---------------------------------------------------------- */
function renderBalances() {
  const table = document.getElementById("balanceTable");
  table.innerHTML = `<tr><th>Employee</th><th>Annual</th><th>Sick</th><th>Unpaid</th><th></th></tr>`;
  BALANCES.forEach((b, i) => {
    table.innerHTML += `
      <tr>
        <td>${b.employee}</td>
        <td><input type="number" value="${b.annual}" id="balA${i}"></td>
        <td><input type="number" value="${b.sick}" id="balS${i}"></td>
        <td><input type="number" value="${b.unpaid}" id="balU${i}"></td>
        <td><button class="btn btn-sm btn-primary" onclick="updateBalance(${i})">Save</button></td>
      </tr>`;
  });
}
async function updateBalance(i) {
  const b = BALANCES[i];
  const newRow = {
    employee: b.employee,
    annual: document.getElementById("balA" + i).value,
    sick: document.getElementById("balS" + i).value,
    unpaid: document.getElementById("balU" + i).value
  };
  const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=Balances&action=update`, {
    method: "POST",
    body: JSON.stringify(newRow),
    headers: { "Content-Type": "application/json" }
  });
  const j = await res.json();
  if (j.ok) loadData();
}
function updateBalanceCards() {
  let totalAnnual = 0, totalSick = 0, totalUnpaid = 0;
  BALANCES.forEach(b => {
    totalAnnual += Number(b.annual) || 0;
    totalSick += Number(b.sick) || 0;
    totalUnpaid += Number(b.unpaid) || 0;
  });
  // Subtract leaves taken
  const usedAnnual = LEAVES.filter(l => l.type === "Annual").length;
  const usedSick = LEAVES.filter(l => l.type === "Sick").length;
  const usedUnpaid = LEAVES.filter(l => l.type === "Unpaid").length;
  document.getElementById("annualLeaveCount").textContent = totalAnnual - usedAnnual;
  document.getElementById("sickLeaveCount").textContent = totalSick - usedSick;
  document.getElementById("unpaidLeaveCount").textContent = totalUnpaid - usedUnpaid;
  document.getElementById("holidayCount").textContent = HOLIDAYS.length;
}

/* ----------------------------------------------------------
 * TABLE RENDER + KPIs
 * ---------------------------------------------------------- */
function renderTable(data) {
  const rows = data.map(r => {
    const st = computeStatus(r);
    const badge = st.map(label => {
      let cls = "bg-secondary";
      if (label.includes("Late")) cls = "bg-danger";
      else if (label.includes("Early Leave")) cls = "bg-warning text-dark";
      else if (label.includes("On Time")) cls = "bg-success";
      else if (label.includes("Absent")) cls = "bg-dark";
      else if (label.includes("Needs Correction")) cls = "bg-danger text-white";
      else if (label.includes("Half-day")) cls = "bg-info text-dark";
      else if (label.includes("Overtime")) cls = "bg-primary";
      else if (label.includes("Holiday")) cls = "bg-secondary";
      else if (label.includes("Weekend")) cls = "bg-light text-dark";
      else if (label.includes("Leave")) cls = "bg-info";
      return `<span class="badge ${cls}">${label}</span>`;
    }).join(" ");
    return [r.month, r.date, r.employee, r.signIn || "", r.signOut || "", r.totalHours || "", badge];
  });

  if (!DT) {
    DT = $("#attendanceTable").DataTable({
      data: rows,
      columns: [
        { title: "Month" },
        { title: "Date" },
        { title: "Employee" },
        { title: "Sign In" },
        { title: "Sign Out" },
        { title: "Total Hours" },
        { title: "Status" }
      ],
      dom: "Bfrtip",
      buttons: ["csv", "excel", "pdf", "print"],
      pageLength: 10,
      order: [[1, "asc"]]
    });
  } else {
    DT.clear().rows.add(rows).draw();
  }

  // KPIs
  let sum = 0, late = 0, early = 0, absent = 0, workdays = 0;
  const dates = new Set();
  data.forEach(r => {
    const st = computeStatus(r);
    if (st.includes("Late")) late++;
    if (st.includes("Early Leave")) early++;
    if (st.includes("Absent")) absent++;
    if (r.totalHours) sum += Number(r.totalHours);
    // workday = has sign in/out
    if (r.signIn || r.signOut) workdays++;
    if (r.date) dates.add(r.date);
  });
  document.getElementById("totalHours").textContent = sum.toFixed(2);
  document.getElementById("avgHours").textContent = (workdays ? sum / workdays : 0).toFixed(2);
  document.getElementById("daysCount").textContent = workdays;
  document.getElementById("lateCount").textContent = late;
  document.getElementById("earlyCount").textContent = early;
  document.getElementById("absentCount").textContent = absent;

  updateBalanceCards();
  renderCharts(data);
}

/* ----------------------------------------------------------
 * CHARTS
 * ---------------------------------------------------------- */
function renderCharts(data) {
  if (barChartHandle) barChartHandle.destroy();
  if (pieChartHandle) pieChartHandle.destroy();
  if (lineChartHandle) lineChartHandle.destroy();

  const byDate = {};
  const byEmp = {};
  data.forEach(r => {
    if (r.date) byDate[r.date] = (byDate[r.date] || 0) + (Number(r.totalHours) || 0);
    if (r.employee) byEmp[r.employee] = (byEmp[r.employee] || 0) + (Number(r.totalHours) || 0);
  });

  barChartHandle = new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: { labels: Object.keys(byDate), datasets: [{ label: "Hours", data: Object.values(byDate), backgroundColor: "#0d6efd" }] }
  });
  pieChartHandle = new Chart(document.getElementById("pieChart"), {
    type: "pie",
    data: { labels: Object.keys(byEmp), datasets: [{ data: Object.values(byEmp), backgroundColor: ["#0d6efd","#00c9a7","#ff7e5f","#6f42c1","#ffc107","#20c997","#fd7e14"] }] }
  });
  lineChartHandle = new Chart(document.getElementById("lineChart"), {
    type: "line",
    data: { labels: Object.keys(byDate), datasets: [{ label: "Trend", data: Object.values(byDate), borderColor: "#28a745", fill: false }] }
  });
}

/* ----------------------------------------------------------
 * LOAD DATA
 * ---------------------------------------------------------- */
async function loadData() {
  const sheets = ["AttendanceSummary","Holidays","Leaves","Balances"];
  const results = {};
  for (let s of sheets) {
    const res = await fetch(`${API_URL}?secret=${SECRET}&sheet=${s}`);
    results[s] = await res.json();
  }

  CANON = results.AttendanceSummary.data.map(r => ({
    month: r[0], date: normalizeDate(r[1]), employee: r[2],
    signIn: r[3], signOut: r[4],
    signInDT: parsePunchWithDate(r[1], r[3]), signOutDT: parsePunchWithDate(r[1], r[4]),
    totalHours: parseFloat(r[5] || 0)
  }));
  HOLIDAYS = results.Holidays.data.map(r => ({ date: normalizeDate(r[0]), name: r[1] }));
  LEAVES = results.Leaves.data.map(r => ({ date: normalizeDate(r[0]), employee: r[1], type: r[2] }));
  BALANCES = results.Balances.data.map(r => ({ employee: r[0], annual: r[1], sick: r[2], unpaid: r[3] }));

  const employees = [...new Set(CANON.map(r => r.employee))].sort();
  const sel = document.getElementById("leaveEmployee");
  sel.innerHTML = employees.map(e => `<option value="${e}">${e}</option>`).join("");
  const sel2 = document.getElementById("employeeFilter");
  sel2.innerHTML = employees.map(e => `<option value="${e}">${e}</option>`).join("");
  $("#employeeFilter").select2({ placeholder: "Select employees" });

  renderTable(CANON);
  renderHolidayList();
  renderLeaveList();
  renderBalances();
}
loadData();
</script>
